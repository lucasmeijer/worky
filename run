#!/bin/zsh
set -euo pipefail

stdout=false
for arg in "$@"; do
  case "$arg" in
    --stdout) stdout=true ;;
    *) ;;
  esac
done

swift build -c release --product Worky
osascript -e 'tell application id "com.lucasmeijer.worky" to quit' >/dev/null 2>&1 || true
pkill -f "/Applications/Worky.app/Contents/MacOS/Worky" >/dev/null 2>&1 || true
sleep 0.5
scripts/build_worky.sh app

app_path="/Applications/Worky.app"
app_bin="$app_path/Contents/MacOS/Worky"

if $stdout; then
  "$app_bin"
else
  open "$app_path"
fi
